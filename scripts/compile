#!/usr/bin/env bash
set -euo pipefail

# Compile all Fennel files to Lua using nfnl
# This script requires Neovim and nfnl to be available

echo "Compiling Fennel files..."

# Set up environment to use test dependencies
export XDG_CONFIG_HOME="$(pwd)/.test"
export XDG_DATA_HOME="$(pwd)/.test"
export XDG_STATE_HOME="$(pwd)/.test"

# Run nfnl compilation
nvim --headless \
    --noplugin \
    -u .test/init.lua \
    -c "lua require('nfnl').setup()" \
    -c "lua require('nfnl.api').compile_all_files()" \
    -c "qa"

echo "Compilation complete!"
