#!/usr/bin/env bash
set -euo pipefail

TEST_DIR=".test"
PACK_DIR="$TEST_DIR/nvim/pack/test/start"

echo "Setting up test dependencies..."

mkdir -p "$PACK_DIR"

# Clone plenary.nvim (required for testing)
if [[ ! -d "$PACK_DIR/plenary.nvim" ]]; then
    echo "Cloning plenary.nvim..."
    git clone --depth 1 https://github.com/nvim-lua/plenary.nvim "$PACK_DIR/plenary.nvim"
else
    echo "plenary.nvim already installed"
fi

# Clone nfnl (required for Fennel compilation)
if [[ ! -d "$PACK_DIR/nfnl" ]]; then
    echo "Cloning nfnl..."
    git clone --depth 1 https://github.com/Olical/nfnl "$PACK_DIR/nfnl"
else
    echo "nfnl already installed"
fi

# Symlink the plugin itself
if [[ ! -L "$PACK_DIR/longway.nvim" ]]; then
    echo "Symlinking longway.nvim..."
    ln -sf "$(pwd)" "$PACK_DIR/longway.nvim"
else
    echo "longway.nvim already symlinked"
fi

echo "Test dependencies ready!"
